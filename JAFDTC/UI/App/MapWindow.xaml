<?xml version="1.0" encoding="utf-8"?>
<!--
**********************************************************************************************************************
    
MapWindow.xaml : ui xaml for map window

Copyright(C) 2025-2026 ilominar/raven

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General
Public License as published by the Free Software Foundation, either version 3 of the License, or (at your
option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the
implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
for more details.
You should have received a copy of the GNU General Public License along with this program.  If not, see
https://www.gnu.org/licenses/.

**********************************************************************************************************************
-->
<Window
    x:Class="JAFDTC.UI.App.MapWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:JAFDTC.UI.App"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:map="using:MapControl"
    xmlns:ctrl="using:JAFDTC.UI.Controls.Map"
    mc:Ignorable="d">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>
    
    <Grid x:Name="uiContent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- title bar area -->
        <TitleBar Grid.Row="0" x:Name="uiAppTitleBar"
                  Title="JAFDTC"
                  Subtitle="Map View">
<!--
            This breaks window resize from the top edge of the window due to a bug in TitleBar, see
            https://github.com/microsoft/microsoft-ui-xaml/issues/10374

            <TitleBar.IconSource>
                <ImageIconSource ImageSource="ms-appx:///Assets/Square44x44Logo.scale-100.png" />
            </TitleBar.IconSource>

            Workaround here https://github.com/microsoft/WinUI-Gallery/commit/10f9920bf3923a505111da147318ef4359f9e216
            leads to wonky layout (misalignment of text with minimize/maximize/close widgets) but
            does fix the resize issue.

            <TitleBar.LeftHeader>
                <ImageIcon Height="16" Margin="16,-2,0,0" Source="ms-appx:///Assets/Square44x44Logo.scale-100.png" />
            </TitleBar.LeftHeader>
-->
        </TitleBar>

        <!-- command bar top area -->
        <Grid Grid.Row="1" Margin="16,6,16,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <CommandBar Grid.Column="0" Margin="12,0,0,0"
                        HorizontalAlignment="Center">
                <AppBarButton x:Name="uiBarBtnAdd" Icon="Add" Label="Add"
                              Click="CmdAdd_Click"
                              ToolTipService.ToolTip="Add non-route marker"/>
<!--
                TODO: these commands should eventually show up...

                <AppBarButton x:Name="uiBarBtnLine" Label="Add Line"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xED63;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnRect" Label="Add rectangle"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF16B;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnCircle" Label="Add circle"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF138;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnBulls" Label="Set bullseye"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF272;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
-->
                <AppBarSeparator/>
                <AppBarButton x:Name="uiBarBtnEdit" Icon="Edit" Label="Edit"
                              Click="CmdEdit_Click"
                              ToolTipService.ToolTip="Edit selected marker"/>
                <AppBarButton x:Name="uiBarBtnDelete" Icon="Delete" Label="Delete"
                              Click="CmdDelete_Click"
                              ToolTipService.ToolTip="Delete selected marker"/>
                <AppBarSeparator/>
                <AppBarButton x:Name="uiBarBtnImport" Label="Import Threats"
                              Click="CmdImportThreats_Click"
                              ToolTipService.ToolTip="Import mission threat and unit markers">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE945;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnClear" Label="Clear Threats"
                              Click="CmdClearThreats_Click"
                              ToolTipService.ToolTip="Clear mission threat and unit markers">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE894;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarSeparator/>
                <AppBarToggleButton x:Name="uiBarBtnSnap" Label="Snap to Markers"
                                    Click="CmdSnap_Click"
                                    ToolTipService.ToolTip="Enable snapping to markers on map">
                    <AppBarToggleButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE73F;"/>
                    </AppBarToggleButton.Icon>
                </AppBarToggleButton>
                <AppBarToggleButton x:Name="uiBarBtnFilter" Label="Filter Markers"
                                    Click="CmdFilter_Click"
                                    ToolTipService.ToolTip="Set filter to apply to markers">
                    <AppBarToggleButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE71C;"/>
                    </AppBarToggleButton.Icon>
                </AppBarToggleButton>
                <AppBarSeparator/>
                <AppBarButton x:Name="uiBarBtnSettings" Label="Settings"
                              Click="CmdSettings_Click"
                              ToolTipService.ToolTip="Change map window settings">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE713;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarSeparator/>
            </CommandBar>
            <Slider x:Name="uiSliderZoom" Grid.Column="2" Width="200" Margin="12,0,0,0"
                    ValueChanged="ZoomSlider_ValueChanged"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center">
            </Slider>
        </Grid>

        <!-- map area
        -->
        <Grid x:Name="uiMapGrid" Grid.Row="2">
            <ctrl:MapControl x:Name="uiMap"
                             Background="#FF202020"
                             MinZoomLevel="2"
                             MaxZoomLevel="18"
                             ManipulationMode="All">
                <ctrl:MapControl.Resources>
                    <!--
                    basic brushes.
                    -->
                    <SolidColorBrush x:Key="Brush_Default" Color="#FF303030"/>

                    <!--
                    brushes for boundary lines.
                    -->
                    <SolidColorBrush x:Key="Brush_Boundary" Color="#FFA0A0A0"/>

                    <!--
                    brushes for yardstick lines.
                    -->
                    <SolidColorBrush x:Key="Brush_Yardstick" Color="#FF202020"/>

                    <!--
                    brushes for base map markers in r/w state. note that THREAT covers both THREAT_FIXED
                    and THREAT_USER.
                    -->
                    <SolidColorBrush x:Key="Brush_Marker_Bg" Color="#ffffffff"/>

                    <SolidColorBrush x:Key="Brush_Marker_POI_Core_0" Color="#FF404040"/>
                    <SolidColorBrush x:Key="Brush_Marker_POI_User_0" Color="#FF404040"/>
                    <SolidColorBrush x:Key="Brush_Marker_POI_Campaign_0" Color="#FFFF8D00"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_0" Color="#FF2E1ED5"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_1" Color="#FF3296B0"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_2" Color="#FFB30ED4"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_3" Color="#FF3B6B04"/>
                    <SolidColorBrush x:Key="Brush_Marker_Unit_0" Color="#FFA00011"/>
                    <SolidColorBrush x:Key="Brush_Marker_Unit_1" Color="#FF1100D0"/>

                    <!--
                    brushes for base map markers in r/o state. note that THREAT covers both THREAT_FIXED
                    and THREAT_USER.
                    -->
                    <SolidColorBrush x:Key="Brush_Marker_POI_Core_0_RO" Color="#FF808080"/>
                    <SolidColorBrush x:Key="Brush_Marker_POI_User_0_RO" Color="#FF808080"/>
                    <SolidColorBrush x:Key="Brush_Marker_POI_Campaign_0_RO" Color="#FFFFB753"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_0_RO" Color="#FF8078FF"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_1_RO" Color="#FF8ACCBF"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_2_RO" Color="#FFE77EEF"/>
                    <SolidColorBrush x:Key="Brush_Marker_Path_3_RO" Color="#FF96B77B"/>
                    <SolidColorBrush x:Key="Brush_Marker_Unit_0_RO" Color="#FFA04050"/>
                    <SolidColorBrush x:Key="Brush_Marker_Unit_1_RO" Color="#FF5040A0"/>

                    <!--
                    brushes for threat ring fills.
                    -->
                    <SolidColorBrush x:Key="Brush_Ring_Fill_0" Color="#10A00011"/>
                    <SolidColorBrush x:Key="Brush_Ring_Fill_1" Color="#101100D0"/>

                    <!--
                    data template for boundary lines geometry.
                    -->
                    <DataTemplate x:Key="Tmplt_Boundary_Path">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Boundary}"
                                           StrokeThickness="1.5"
                                           StrokeLineJoin="Round"
                                           StrokeDashCap="Round"
                                           StrokeDashArray="5,4"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>

                    <!--
                    data template for yardstick lines geometry.
                    -->
                    <DataTemplate x:Key="Tmplt_Yardstick_Fg_Path">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Yardstick}"
                                           StrokeThickness="3.0"
                                           StrokeLineJoin="Round"
                                           StrokeDashCap="Round"
                                           StrokeDashArray="2,1.5"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Yardstick_Bg_Path">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Bg}"
                                           StrokeThickness="5.0"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>

                    <!--
                    data templates for the RouteLine?FgTemplate for MapRoutePath geometries. these need to be
                    kept in sync with the source code. this is a mess as i'm probably fighting aginst xaml here.
                    -->
                    <DataTemplate x:Key="Tmplt_Path_Bg">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Bg}"
                                           StrokeThickness="8"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>

                    <DataTemplate x:Key="Tmplt_Path_0">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_0}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Path_1">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_1}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Path_2">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_2}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Path_3">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_3}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>

                    <DataTemplate x:Key="Tmplt_Path_0_RO">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_0_RO}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Path_1_RO">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_1_RO}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Path_2_RO">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_2_RO}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Path_3_RO">
                        <ctrl:MapRoutePath Stroke="{StaticResource Brush_Marker_Path_3_RO}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    
                    <!--
                    data templates for the threat ring geometry. these need to be kept in sync with the source
                    code. this is a mess as i'm probably fighting aginst xaml here.
                    -->
                    <DataTemplate x:Key="Tmplt_Ring_Bg">
                        <ctrl:MapThreatPath Stroke="{StaticResource Brush_Marker_Bg}"
                                            StrokeThickness="6"
                                            StrokeLineJoin="Round"
                                            Locations="{Binding Locations}" />
                    </DataTemplate>

                    <DataTemplate x:Key="Tmplt_Ring_Unit_0">
                        <ctrl:MapThreatPath Stroke="{StaticResource Brush_Marker_Unit_0}"
                                            StrokeThickness="2"
                                            StrokeLineJoin="Round"
                                            Fill="{StaticResource Brush_Ring_Fill_0}"
                                            Locations="{Binding Locations}" />
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Ring_Unit_1">
                        <ctrl:MapThreatPath Stroke="{StaticResource Brush_Marker_Unit_1}"
                                            StrokeThickness="2"
                                            StrokeLineJoin="Round"
                                            Fill="{StaticResource Brush_Ring_Fill_1}"
                                            Locations="{Binding Locations}" />
                    </DataTemplate>

                    <DataTemplate x:Key="Tmplt_Ring_Unit_0_RO">
                        <ctrl:MapThreatPath Stroke="{StaticResource Brush_Marker_Unit_0_RO}"
                                            StrokeThickness="2"
                                            StrokeLineJoin="Round"
                                            StrokeDashArray="3,1"
                                            Fill="{StaticResource Brush_Ring_Fill_0}"
                                            Locations="{Binding Locations}" />
                    </DataTemplate>
                    <DataTemplate x:Key="Tmplt_Ring_Unit_1_RO">
                        <ctrl:MapThreatPath Stroke="{StaticResource Brush_Marker_Unit_1_RO}"
                                            StrokeThickness="2"
                                            StrokeLineJoin="Round"
                                            StrokeDashArray="3,1"
                                            Fill="{StaticResource Brush_Ring_Fill_1}"
                                            Locations="{Binding Locations}" />
                    </DataTemplate>
                </ctrl:MapControl.Resources>

                <map:MapTileLayer x:Name="uiMapTiles"
                                  TileSource="https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                                  SourceName="OpenStreetMap"
                                  Description="Map Data Â© [OpenStreetMap](http://www.openstreetmap.org/copyright) contributors"/>
            </ctrl:MapControl>
            <StackPanel Background="#A8C8C8C8"
                        VerticalAlignment="Bottom"
                        HorizontalAlignment="Right">
                <TextBlock x:Name="uiMapTextAttribution" Margin="8,2,8,2"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           FontSize="10"
                           Foreground="#FF000000"/>
            </StackPanel>
        </Grid>

        <!-- bottom status bar -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Margin="16,6,16,6"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                <TextBlock x:Name="uiTxtTheater" Margin="0,0,0,0"
                           Foreground="{ThemeResource TextFillColorTertiary}">
                    THEATER
                </TextBlock>

                <TextBlock x:Name="uiTxtMouseLat" Width="90" Margin="12,0,0,0"
                           Foreground="{ThemeResource TextFillColorTertiary}"/>
                <TextBlock x:Name="uiTxtMouseLon" Width="90" Margin="8,0,0,0"
                           Foreground="{ThemeResource TextFillColorTertiary}"/>
            </StackPanel>
            <StackPanel Grid.Column="2" Margin="0,0,0,0"
                        VerticalAlignment="Center">
                <FontIcon x:Name="uiIconEditStatus"
                          Foreground="{ThemeResource TextFillColorTertiary}"
                          FontSize="16"
                          FontFamily="Segoe Fluent Icons"
                          Glyph="&#xE70F;"/>
            </StackPanel>
            <StackPanel Grid.Column="3" Margin="16,6,16,6"
                        Orientation="Vertical"
                        VerticalAlignment="Center">
                <TextBlock x:Name="uiTxtSelName" Margin="0,0,0,0"
                           Foreground="{ThemeResource TextFillColorTertiary}">
                    NAME
                </TextBlock>
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="uiTxtSelLat" Margin="0,0,0,0"
                               Foreground="{ThemeResource TextFillColorTertiary}"/>
                    <TextBlock x:Name="uiTxtSelLon" Margin="8,0,0,0"
                               Foreground="{ThemeResource TextFillColorTertiary}"/>
                    <TextBlock x:Name="uiLblSelAlt" Margin="10,0,0,0"
                               Foreground="{ThemeResource TextFillColorTertiary}">ALT:</TextBlock>
                    <TextBlock x:Name="uiTxtSelAlt" Margin="8,0,0,0"
                               Foreground="{ThemeResource TextFillColorTertiary}">0'</TextBlock>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
