<?xml version="1.0" encoding="utf-8"?>
<!--
**********************************************************************************************************************
    
MapWindow.xaml : ui xaml for map window

Copyright(C) 2025 ilominar/raven

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General
Public License as published by the Free Software Foundation, either version 3 of the License, or (at your
option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the
implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
for more details.
You should have received a copy of the GNU General Public License along with this program.  If not, see
https://www.gnu.org/licenses/.

**********************************************************************************************************************
-->
<Window
    x:Class="JAFDTC.UI.App.MapWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:JAFDTC.UI.App"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:map="using:MapControl"
    xmlns:ctrl="using:JAFDTC.UI.Controls.Map"
    mc:Ignorable="d">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>
    
    <Grid x:Name="uiContent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- title bar area -->
        <TitleBar Grid.Row="0" x:Name="uiAppTitleBar"
                  Title="JAFDTC"
                  Subtitle="Map View">
<!--
            This breaks window resize from the top edge of the window due to a bug in TitleBar, see
            https://github.com/microsoft/microsoft-ui-xaml/issues/10374

            <TitleBar.IconSource>
                <ImageIconSource ImageSource="ms-appx:///Assets/Square44x44Logo.scale-100.png" />
            </TitleBar.IconSource>

            Workaround here https://github.com/microsoft/WinUI-Gallery/commit/10f9920bf3923a505111da147318ef4359f9e216
            leads to wonky layout (misalignment of text with minimize/maximize/close widgets) but
            does fix the resize issue.

            <TitleBar.LeftHeader>
                <ImageIcon Height="16" Margin="16,-2,0,0" Source="ms-appx:///Assets/Square44x44Logo.scale-100.png" />
            </TitleBar.LeftHeader>
-->
        </TitleBar>

        <!-- command bar top area -->
        <Grid Grid.Row="1" Margin="16,6,16,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <CommandBar Grid.Column="0" Margin="12,0,0,0"
                        HorizontalAlignment="Center">
                <AppBarButton x:Name="uiBarBtnAdd" Icon="Add" Label="Add"
                              Click="CmdAdd_Click"
                              ToolTipService.ToolTip="Add non-route marker"/>
<!--
                TODO: these commands should eventually show up...

                <AppBarButton x:Name="uiBarBtnLine" Label="Add Line"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xED63;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnRect" Label="Add rectangle"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF16B;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnCircle" Label="Add circle"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF138;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnBulls" Label="Set bullseye"
                              ToolTipService.ToolTip="TODO">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF272;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
-->
                <AppBarSeparator/>
                <AppBarButton x:Name="uiBarBtnEdit" Icon="Edit" Label="Edit"
                              Click="CmdEdit_Click"
                              ToolTipService.ToolTip="Edit selected marker"/>
                <AppBarButton x:Name="uiBarBtnDelete" Icon="Delete" Label="Delete"
                              Click="CmdDelete_Click"
                              ToolTipService.ToolTip="Delete selected marker"/>
                <AppBarSeparator/>
                <AppBarButton x:Name="uiBarBtnImport" Icon="Download" Label="Import"
                              Click="CmdImport_Click"
                              ToolTipService.ToolTip="Manage imported markers">
                </AppBarButton>
                <AppBarButton x:Name="uiBarBtnSettings" Label="Settings"
                              Click="CmdSettings_Click"
                              ToolTipService.ToolTip="Change map window settings">
                    <AppBarButton.Icon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE713;"/>
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarSeparator/>
            </CommandBar>
            <Slider x:Name="uiSliderZoom" Grid.Column="2" Width="200" Margin="12,0,0,0"
                    ValueChanged="ZoomSlider_ValueChanged"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center">
            </Slider>
        </Grid>

        <!-- map area -->
        <Grid x:Name="uiMapGrid" Grid.Row="2">
            <ctrl:MapControl x:Name="uiMap"
                     Background="#FF202020"
                     MinZoomLevel="2"
                     MaxZoomLevel="18"
                     ManipulationMode="All">
                <ctrl:MapControl.Resources>
                    <!--
                    brushes for base map markers in r/w state.
                    -->
                    <SolidColorBrush x:Key="MapMarker_Bkgnd_Brush" Color="#ffffffff"/>

                    <SolidColorBrush x:Key="MapMarker_DCS_CORE_Brush" Color="#ff202020"/>
                    <SolidColorBrush x:Key="MapMarker_USER_Brush" Color="#ff900000"/>
                    <SolidColorBrush x:Key="MapMarker_CAMPAIGN_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT0_Brush" Color="#ff0a0acc"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT1_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT2_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT3_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_IMPORT_GEN_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_IMPORT_S2A_Brush" Color="Orange"/>

                    <!--
                    brushes for base map markers in r/o state.
                    -->
                    <SolidColorBrush x:Key="MapMarker_DCS_CORE_RO_Brush" Color="#ff484848"/>
                    <SolidColorBrush x:Key="MapMarker_USER_RO_Brush" Color="#ff880000"/>
                    <SolidColorBrush x:Key="MapMarker_CAMPAIGN_RO_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT0_RO_Brush" Color="#ff7a7acc"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT1_RO_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT2_RO_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_NAVPT3_RO_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_IMPORT_GEN_RO_Brush" Color="Orange"/>
                    <SolidColorBrush x:Key="MapMarker_IMPORT_S2A_RO_Brush" Color="Orange"/>

                    <!--
                    stroke colors for the RouteLine?FgTemplate data templates need to be kept in sync with the
                    source code. this is a bit of a mess as i'm probably fighting aginst xaml here.
                    -->
                    <DataTemplate x:Key="RouteLineBgTemplate">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_Bkgnd_Brush}"
                                           StrokeThickness="8"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>

                    <DataTemplate x:Key="RouteLineFg_0_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT0_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>
                    <DataTemplate x:Key="RouteLineFg_1_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT1_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="RouteLineFg_2_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT2_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}" />
                    </DataTemplate>
                    <DataTemplate x:Key="RouteLineFg_3_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT2_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>

                    <DataTemplate x:Key="RouteLineFg_0_RO_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT0_RO_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="RouteLineFg_1_RO_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT1_RO_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="RouteLineFg_2_RO_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT2_RO_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="RouteLineFg_3_RO_Template">
                        <ctrl:MapRoutePath Stroke="{StaticResource MapMarker_NAVPT3_RO_Brush}"
                                           StrokeThickness="4"
                                           StrokeLineJoin="Round"
                                           Locations="{Binding Locations}"/>
                    </DataTemplate>
                </ctrl:MapControl.Resources>

                <map:MapTileLayer x:Name="uiMapTiles"
                                  TileSource="https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                                  SourceName="OpenStreetMap"
                                  Description="© [OpenStreetMap contributors](http://www.openstreetmap.org/copyright)"/>
            </ctrl:MapControl>
        </Grid>

        <!-- command bar bottom area -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Margin="16,6,16,6"
                        Orientation="Horizontal">
                <TextBlock x:Name="uiTxtTheater" Margin="0,0,0,0">THEATER</TextBlock>

                <TextBlock x:Name="uiTxtMouseLat" Width="90" Margin="12,0,0,0"/>
                <TextBlock x:Name="uiTxtMouseLon" Width="90" Margin="8,0,0,0"/>
            </StackPanel>
            <StackPanel Grid.Column="2" Margin="16,6,16,6"
                        Orientation="Horizontal">
                <TextBlock x:Name="uiTxtSelName" Margin="0,0,0,0">NAME</TextBlock>

                <TextBlock x:Name="uiTxtSelLat" Margin="12,0,0,0"/>
                <TextBlock x:Name="uiTxtSelLon" Margin="8,0,0,0"/>

                <TextBlock x:Name="uiLblSelAlt" Margin="12,0,0,0">ALT:</TextBlock>
                <TextBlock x:Name="uiTxtSelAlt" Margin="8,0,0,0">0'</TextBlock>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
